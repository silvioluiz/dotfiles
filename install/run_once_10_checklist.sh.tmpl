#!/bin/bash
set -e

echo "===== üöÄ Iniciando checklist do ambiente chezmoi ====="

# 1. Shell e prompt
echo "[1/9] Testando shell e prompt..."
if [[ "$SHELL" == *"zsh" ]]; then
  echo "‚úÖ Shell padr√£o √© Zsh"
else
  echo "‚ùå Shell padr√£o n√£o √© Zsh"
fi

if command -v starship &>/dev/null; then
  echo "‚úÖ Starship instalado: $(starship --version)"
else
  echo "‚ùå Starship n√£o encontrado"
fi

# 2. Plugins Zsh
echo "[2/9] Testando plugins Zsh..."
if [[ -n "$(typeset -f _fzf_tab_completion 2>/dev/null)" ]]; then
  echo "‚úÖ fzf-tab carregado"
else
  echo "‚ö†Ô∏è fzf-tab n√£o detectado"
fi

if [[ -n "$ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE" ]]; then
  echo "‚úÖ zsh-autosuggestions carregado"
else
  echo "‚ö†Ô∏è zsh-autosuggestions n√£o detectado"
fi

if command -v zoxide &>/dev/null; then
  echo "‚úÖ zoxide instalado"
else
  echo "‚ùå zoxide n√£o encontrado"
fi

# 3. asdf e linguagens
echo "[3/9] Testando asdf..."
if command -v asdf &>/dev/null; then
  echo "‚úÖ asdf instalado: $(asdf --version)"
  for lang in nodejs python golang; do
    if asdf list "$lang" &>/dev/null; then
      echo "‚úÖ $lang configurado no asdf"
    else
      echo "‚ùå $lang n√£o encontrado no asdf"
    fi
  done
else
  echo "‚ùå asdf n√£o encontrado"
fi

# 4. CLIs cloud
echo "[4/9] Testando CLIs cloud..."
for cli in aws gh gcloud; do
  if command -v $cli &>/dev/null; then
    echo "‚úÖ $cli instalado: $($cli --version | head -n1)"
  else
    echo "‚ùå $cli n√£o encontrado"
  fi
done

# 5. Multiplexadores
echo "[5/9] Testando multiplexadores..."
for mux in tmux zellij; do
  if command -v $mux &>/dev/null; then
    echo "‚úÖ $mux instalado: $($mux -V 2>/dev/null || $mux --version)"
  else
    echo "‚ùå $mux n√£o encontrado"
  fi
done

# 6. Neovim
echo "[6/9] Testando Neovim..."
if command -v nvim &>/dev/null; then
  echo "‚úÖ Neovim instalado: $(nvim --version | head -n1)"
  if [[ -d "$HOME/.local/share/nvim/lazy/LazyVim" ]]; then
    echo "‚úÖ LazyVim detectado"
  else
    echo "‚ö†Ô∏è LazyVim n√£o detectado"
  fi
else
  echo "‚ùå Neovim n√£o encontrado"
fi

# 7. Utilit√°rios comuns
echo "[7/9] Testando utilit√°rios comuns..."
COMMON_TOOLS=(bat ripgrep fzf curlie lazygit lazydocker navi yazi fd eza hurl)
for tool in "${COMMON_TOOLS[@]}"; do
  if command -v $tool &>/dev/null; then
    echo "‚úÖ $tool instalado"
  else
    echo "‚ùå $tool n√£o encontrado"
  fi
done

# 8. Validar PATH
echo "[8/9] Validando PATH..."
echo "$PATH" | tr ':' '\n'

# 9. Finaliza√ß√£o
echo "[9/9] Checklist conclu√≠do!"
echo "===== ‚úÖ Fim ====="
