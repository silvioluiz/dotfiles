#!/bin/bash
set -euo pipefail
source "$(dirname "$0")/helpers/init_macos_env.sh"

echo "[+] Instalando pacotes CLI utilitários..."

MACOS_COMMON_PACKAGES=(
  
  bat btop curlie dust eza fd fzf htop hurl

  k9s lazydocker navi nushell ripgrep

  shellcheck starship yazi zoxide
)

UNIX_COMMON_PACKAGES=(
  
    bat btop fd-find fzf htop ripgrep shellcheck zoxide

)

#echo "[+] Instalando Atuin..."
#curl --proto '=https' --tlsv1.2 -LsSf https://setup.atuin.sh | sh



if [[ "$OSTYPE" == "darwin"* ]]; then
  echo "[+] Instalando via Homebrew..."
  brew install "${MACOS_COMMON_PACKAGES[@]}"
  echo "[+] Instalando k9s..."
  brew install derailed/k9s/k9s

elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
  echo "[+] Instalando via APT..."
  sudo apt update
  sudo apt install -y "${UNIX_COMMON_PACKAGES[@]}"

  echo "[+] Instalando curlie..."
  curl -sS https://webinstall.dev/curlie | bash

  echo "[+] Instalando dust..."
  sudo snap install dust

  echo "[+] Adicionando repositório eza-community/eza..."
  sudo mkdir -p /etc/apt/keyrings
  wget -qO- https://raw.githubusercontent.com/eza-community/eza/main/deb.asc | \
    sudo gpg --dearmor -o /etc/apt/keyrings/gierens.gpg
  echo "deb [signed-by=/etc/apt/keyrings/gierens.gpg] http://deb.gierens.de stable main" | \
    sudo tee /etc/apt/sources.list.d/eza.list > /dev/null
  sudo chmod 644 /etc/apt/keyrings/gierens.gpg /etc/apt/sources.list.d/eza.list
  sudo apt install -y eza

  echo "[+] Instalando k9s..."
  sudo snap remove --purge k9s || true
  arch="$(dpkg --print-architecture)"   # amd64 ou arm64
  wget -q -O /tmp/k9s.deb "https://github.com/derailed/k9s/releases/latest/download/k9s_linux_${arch}.deb" \
  || wget -q -O /tmp/k9s.deb "https://github.com/derailed/k9s/releases/latest/download/k9s_Linux_${arch}.deb"
  sudo apt install -y /tmp/k9s.deb || { sudo apt -f install -y && sudo apt install -y /tmp/k9s.deb; }
  rm -f /tmp/k9s.deb
  which k9s
  k9s version

  echo "[+] Instalando lazydocker..."
  curl https://raw.githubusercontent.com/jesseduffield/lazydocker/master/scripts/install_update_linux.sh | bash

  #echo "[+] Instalando lazygit..."
  #sudo add-apt-repository -y ppa:lazygit-team/release
  #sudo apt update
  #sudo apt install -y lazygit
  

  echo "[+] Instalando Hurl (.deb oficial)..."
  HURL_VERSION=7.0.0
  sudo apt-add-repository -y ppa:lepapareil/hurl
  sudo apt install -y hurl="${HURL_VERSION}"*

  echo "[+] Instalando Navi..."
  mkdir -p "$HOME/.local/bin"
  BIN_DIR="$HOME/.local/bin" \
  curl -fsSL https://raw.githubusercontent.com/denisidoro/navi/master/scripts/install \
  | bash

  
  echo "[+] Instalando nushell..."
  mise exec -- cargo binstall -y nu --locked
  
  echo "[+] Instalando Yazi..."
  mise exec -- cargo binstall -y yazi-fm yazi-cli --locked
  
fi

echo "[✔] Pacotes CLI básicos instalados com sucesso!"
