#!/bin/bash
set -euo pipefail
{{ include "init_macos_env" | indent 0 }}

echo "[+] Instalando pacotes CLI básicos..."

if [[ "$OSTYPE" == "darwin"* ]]; then
  echo "[i] Validando ambiente macOS..."

  # 1) Valida se o Xcode Command Line Tools está instalado e ativo.
  if ! xcode-select -p >/dev/null 2>&1; then
      echo "[!] Erro: Xcode Command Line Tools não encontradas." >&2
      echo "    Por favor, instale-as com 'xcode-select --install' ou instalando o Xcode completo." >&2
      exit 1
  fi

  # 2) Valida se o Homebrew está instalado e no PATH.
  if ! command -v brew >/dev/null 2>&1; then
      echo "[!] Erro: Homebrew não encontrado no PATH." >&2
      echo "    Por favor, instale o Homebrew antes de executar este script." >&2
      echo "    https://brew.sh" >&2
      exit 1
  fi

  echo "[+] Instalando pacotes via Homebrew..."
  brew install autoconf automake curl git gnupg ncurses pkg-config tree unzip

  echo "[+] Instalando opcionais pro Yazi..."
  brew install ffmpeg sevenzip jq poppler resvg imagemagick font-symbols-only-nerd-font
  
elif [[ "$OSTYPE" == "linux-gnu"* || "$OSTYPE" == "linux"* ]]; then
  echo "[+] Instalando via APT..."
  sudo apt-get update -y
  sudo apt-get install -y \
    autoconf automake build-essential curl git gnupg ca-certificates \
    libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev \
    libffi-dev libncurses-dev xz-utils tk-dev uuid-dev tree \
    pkg-config libgdbm-dev liblzma-dev libnss3-dev
  sudo apt-get install -y fontconfig snapd

  

fi

echo "[✔] Pacotes CLI básicos instalados com sucesso!"
