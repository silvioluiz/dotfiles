#!/bin/bash
set -euo pipefail

echo "[+] Instalando pacotes CLI básicos..."

if [[ "$OSTYPE" == "darwin"* ]]; then
  # 1) Xcode CLT (interativo). Só chama se não estiver instalado.
  if ! xcode-select -p >/dev/null 2>&1; then
    echo "[+] Instalando dependências via Xcode CLT (interativo)..."
    xcode-select --install || true
  fi

  # 2) Homebrew (não reinstala; usa modo não-interativo)
  if ! command -v brew >/dev/null 2>&1; then
    echo "[+] Instalando Homebrew..."
    NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  fi

  # 3) Garante brew no PATH (Apple Silicon)
  if [[ -d /opt/homebrew/bin ]] && ! command -v brew >/dev/null 2>&1; then
    export PATH="/opt/homebrew/bin:$PATH"
  fi

  echo "[+] Instalando via Homebrew..."
  brew install autoconf automake git gnupg ncurses pkg-config tree unzip
  
elif [[ "$OSTYPE" == "linux-gnu"* || "$OSTYPE" == "linux"* ]]; then
  echo "[+] Instalando via APT..."
  sudo apt-get update -y
  sudo apt-get install -y \
    autoconf automake build-essential curl git gnupg ca-certificates \
    libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev \
    libffi-dev libncurses-dev xz-utils tk-dev uuid-dev tree \
    pkg-config libgdbm-dev liblzma-dev libnss3-dev
  sudo apt-get install -y snapd

fi

echo "[✔] Pacotes CLI básicos instalados com sucesso!"
